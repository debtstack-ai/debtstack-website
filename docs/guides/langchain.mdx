---
title: LangChain Integration
description: 'Use DebtStack as a LangChain tool'
---

## Overview

DebtStack integrates seamlessly with LangChain, enabling you to build credit analysis agents that can search companies, analyze bonds, and traverse corporate structures.

## Installation

```bash
pip install langchain langchain-openai requests
```

## Quick Start

```python
from langchain.agents import AgentType, initialize_agent
from langchain.tools import StructuredTool
from langchain_openai import ChatOpenAI
from pydantic import BaseModel, Field
import requests

API_KEY = "ds_xxxxx"
HEADERS = {"X-API-Key": API_KEY}
BASE_URL = "https://api.debtstack.ai/v1"


# Define tool schemas
class SearchCompaniesInput(BaseModel):
    ticker: str = Field(default=None, description="Comma-separated company tickers")
    sector: str = Field(default=None, description="Business sector")
    min_leverage: float = Field(default=None, description="Minimum leverage ratio")
    fields: str = Field(default="ticker,name,net_leverage_ratio", description="Fields to return")


class SearchBondsInput(BaseModel):
    ticker: str = Field(default=None, description="Company ticker")
    min_ytm: float = Field(default=None, description="Minimum yield to maturity (%)")
    seniority: str = Field(default=None, description="senior_secured, senior_unsecured, subordinated")
    fields: str = Field(default="name,cusip,coupon_rate,maturity_date,pricing", description="Fields to return")


class ResolveBindInput(BaseModel):
    query: str = Field(description="Bond description or CUSIP (e.g., 'RIG 8% 2027')")


# Define tool functions
def search_companies(ticker=None, sector=None, min_leverage=None, fields="ticker,name,net_leverage_ratio"):
    """Search for companies in the DebtStack database."""
    params = {"fields": fields}
    if ticker:
        params["ticker"] = ticker
    if sector:
        params["sector"] = sector
    if min_leverage:
        params["min_leverage"] = min_leverage

    response = requests.get(f"{BASE_URL}/companies", params=params, headers=HEADERS)
    return response.json()["data"]


def search_bonds(ticker=None, min_ytm=None, seniority=None, fields="name,cusip,coupon_rate,maturity_date,pricing"):
    """Search for bonds by yield, seniority, or company."""
    params = {"fields": fields}
    if ticker:
        params["ticker"] = ticker
    if min_ytm:
        params["min_ytm"] = min_ytm
        params["has_pricing"] = True
    if seniority:
        params["seniority"] = seniority

    response = requests.get(f"{BASE_URL}/bonds", params=params, headers=HEADERS)
    return response.json()["data"]


def resolve_bond(query: str):
    """Resolve a bond description to structured data including CUSIP."""
    response = requests.get(f"{BASE_URL}/bonds/resolve", params={"q": query}, headers=HEADERS)
    data = response.json()["data"]
    if data["matches"]:
        return data["matches"][0]["bond"]
    return {"error": "No matching bond found", "suggestions": data.get("suggestions", [])}


# Create tools
tools = [
    StructuredTool.from_function(
        func=search_companies,
        name="search_companies",
        description="Search for companies by leverage, sector, or ticker. Returns company metrics including debt and leverage ratios.",
        args_schema=SearchCompaniesInput
    ),
    StructuredTool.from_function(
        func=search_bonds,
        name="search_bonds",
        description="Search for bonds by yield, seniority, or company. Returns bond details including pricing when available.",
        args_schema=SearchBondsInput
    ),
    StructuredTool.from_function(
        func=resolve_bond,
        name="resolve_bond",
        description="Convert a bond description (like 'RIG 8% 2027') to structured data including CUSIP identifier.",
        args_schema=ResolveBindInput
    )
]

# Create agent
llm = ChatOpenAI(model="gpt-4", temperature=0)
agent = initialize_agent(
    tools,
    llm,
    agent=AgentType.STRUCTURED_CHAT_ZERO_SHOT_REACT_DESCRIPTION,
    verbose=True
)

# Run queries
result = agent.run("Which MAG7 company has the highest leverage?")
print(result)
```

## Complete Tool Set

Here's a comprehensive set of DebtStack tools for LangChain:

```python
from langchain.tools import StructuredTool
from pydantic import BaseModel, Field
import requests

API_KEY = "ds_xxxxx"
HEADERS = {"X-API-Key": API_KEY}
BASE_URL = "https://api.debtstack.ai/v1"


# === Tool Schemas ===

class SearchCompaniesInput(BaseModel):
    ticker: str = Field(default=None, description="Comma-separated tickers (e.g., 'AAPL,MSFT')")
    sector: str = Field(default=None, description="Business sector (e.g., 'Technology')")
    min_leverage: float = Field(default=None, description="Minimum leverage ratio")
    max_leverage: float = Field(default=None, description="Maximum leverage ratio")
    has_structural_sub: bool = Field(default=None, description="Filter for structural subordination")
    fields: str = Field(default="ticker,name,sector,net_leverage_ratio,total_debt")


class SearchBondsInput(BaseModel):
    ticker: str = Field(default=None, description="Company ticker")
    min_ytm: float = Field(default=None, description="Minimum YTM (%)")
    max_ytm: float = Field(default=None, description="Maximum YTM (%)")
    seniority: str = Field(default=None, description="senior_secured, senior_unsecured, subordinated")
    maturity_before: str = Field(default=None, description="Maturity before date (YYYY-MM-DD)")
    fields: str = Field(default="name,cusip,company_ticker,coupon_rate,maturity_date,seniority,pricing")


class ResolveBondInput(BaseModel):
    query: str = Field(description="Bond description (e.g., 'RIG 8% 2027') or CUSIP")


class GetGuarantorsInput(BaseModel):
    cusip: str = Field(description="Bond CUSIP to find guarantors for")


class SearchDocumentsInput(BaseModel):
    query: str = Field(description="Search terms (e.g., 'leverage covenant')")
    ticker: str = Field(default=None, description="Company ticker to filter by")
    section_type: str = Field(default=None, description="debt_footnote, credit_agreement, indenture, covenants")


class GetCompanyChangesInput(BaseModel):
    ticker: str = Field(description="Company ticker")
    since: str = Field(description="Date to compare from (YYYY-MM-DD)")


# === Tool Functions ===

def search_companies(**kwargs):
    """Search companies by metrics."""
    params = {k: v for k, v in kwargs.items() if v is not None}
    response = requests.get(f"{BASE_URL}/companies", params=params, headers=HEADERS)
    return response.json()["data"]


def search_bonds(**kwargs):
    """Search bonds by criteria."""
    params = {k: v for k, v in kwargs.items() if v is not None}
    if params.get("min_ytm") or params.get("max_ytm"):
        params["has_pricing"] = True
    response = requests.get(f"{BASE_URL}/bonds", params=params, headers=HEADERS)
    return response.json()["data"]


def resolve_bond(query: str):
    """Resolve bond description to CUSIP."""
    response = requests.get(f"{BASE_URL}/bonds/resolve", params={"q": query}, headers=HEADERS)
    matches = response.json()["data"]["matches"]
    return matches[0]["bond"] if matches else {"error": "No match found"}


def get_guarantors(cusip: str):
    """Get entities that guarantee a bond."""
    response = requests.post(
        f"{BASE_URL}/entities/traverse",
        headers={**HEADERS, "Content-Type": "application/json"},
        json={
            "start": {"type": "bond", "id": cusip},
            "relationships": ["guarantees"],
            "direction": "inbound",
            "fields": ["name", "entity_type", "jurisdiction", "is_guarantor"]
        }
    )
    return response.json()["data"]["traversal"]["entities"]


def search_documents(query: str, ticker: str = None, section_type: str = None):
    """Search SEC filings."""
    params = {"q": query, "fields": "ticker,section_type,snippet,relevance_score"}
    if ticker:
        params["ticker"] = ticker
    if section_type:
        params["section_type"] = section_type
    response = requests.get(f"{BASE_URL}/documents/search", params=params, headers=HEADERS)
    return response.json()["data"]


def get_company_changes(ticker: str, since: str):
    """Get debt structure changes since a date."""
    response = requests.get(
        f"{BASE_URL}/companies/{ticker}/changes",
        params={"since": since},
        headers=HEADERS
    )
    return response.json()["data"]


# === Create Tools ===

debtstack_tools = [
    StructuredTool.from_function(
        func=search_companies,
        name="search_companies",
        description="Search companies by leverage, sector, debt metrics. Use for company screening and comparisons.",
        args_schema=SearchCompaniesInput
    ),
    StructuredTool.from_function(
        func=search_bonds,
        name="search_bonds",
        description="Search bonds by yield, seniority, maturity. Use for bond screening and yield hunting.",
        args_schema=SearchBondsInput
    ),
    StructuredTool.from_function(
        func=resolve_bond,
        name="resolve_bond",
        description="Convert bond description to CUSIP and details. Use when user mentions a bond by name.",
        args_schema=ResolveBondInput
    ),
    StructuredTool.from_function(
        func=get_guarantors,
        name="get_guarantors",
        description="Find entities guaranteeing a bond. Use for credit analysis and structural subordination.",
        args_schema=GetGuarantorsInput
    ),
    StructuredTool.from_function(
        func=search_documents,
        name="search_documents",
        description="Search SEC filings for covenant language, debt terms, etc.",
        args_schema=SearchDocumentsInput
    ),
    StructuredTool.from_function(
        func=get_company_changes,
        name="get_company_changes",
        description="Track changes in debt structure since a date. Use for monitoring issuances and maturities.",
        args_schema=GetCompanyChangesInput
    )
]
```

## Example Queries

```python
from langchain_openai import ChatOpenAI
from langchain.agents import AgentType, initialize_agent

llm = ChatOpenAI(model="gpt-4", temperature=0)
agent = initialize_agent(
    debtstack_tools,
    llm,
    agent=AgentType.STRUCTURED_CHAT_ZERO_SHOT_REACT_DESCRIPTION,
    verbose=True
)

# Leverage comparison
agent.run("Compare the leverage of RIG, VAL, and DO")

# High-yield screening
agent.run("Find bonds yielding more than 9%")

# Structural analysis
agent.run("Does RIG's 8% 2027 bond have a parent company guarantee?")

# Covenant search
agent.run("What are Charter's leverage covenants?")

# Change tracking
agent.run("What new debt has RIG issued since October 2025?")
```

## LangChain Expression Language (LCEL)

```python
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.output_parsers import StrOutputParser
from langchain_openai import ChatOpenAI

prompt = ChatPromptTemplate.from_messages([
    ("system", """You are a credit analyst assistant with access to DebtStack tools.
    When analyzing companies, always consider:
    1. Leverage levels and trends
    2. Debt structure (secured vs unsecured)
    3. Maturity profile
    4. Structural subordination risk"""),
    ("human", "{question}")
])

llm = ChatOpenAI(model="gpt-4").bind_tools(debtstack_tools)

chain = prompt | llm | StrOutputParser()
```

## Next Steps

<CardGroup cols={2}>
  <Card title="API Reference" icon="book" href="/api-reference/overview">
    Full API documentation
  </Card>
  <Card title="MCP Integration" icon="plug" href="/guides/mcp">
    Use with Claude via MCP
  </Card>
</CardGroup>
